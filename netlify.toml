# ===========================================================
# ðŸœ‚ The Gnostic Key â€” Netlify Configuration
# Version: 2025.10.27
# Purpose:
#   â€¢ Build + deploy Eleventy static site
#   â€¢ Serve authenticated API routes via Netlify Functions
#   â€¢ Securely inject Firebase + Stripe environment variables
# ===========================================================

[build]
  command = "npx @11ty/eleventy"
  publish = "_site"
  functions = "netlify/functions"

[dev]
  command = "npx @11ty/eleventy --serve"
  targetPort = 8080
  port = 8888

# ===========================================================
# ðŸœ‚ Redirects & Routing
# ===========================================================

[[redirects]]
  from = "/logout"
  to = "/signin/"
  status = 302

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# ===========================================================
# ðŸœ‚ Function Settings (Execution Environment)
# ===========================================================

[functions]
  included_files = [
    "src/js/**",
    "src/css/**",
    "src/media/**"
  ]
  node_bundler = "esbuild"
  external_node_modules = ["stripe", "firebase-admin"]

  # Runtime configuration
  node_version = "18.19.0"
  included_files_glob = true

# ===========================================================
# ðŸœ‚ Environment Variables
# Set these securely in Netlify â†’ Site Settings â†’ Environment
# ===========================================================

# ðŸœ‚ Firebase
[build.environment]
  FIREBASE_PROJECT_ID = "your-project-id"
  FIREBASE_CLIENT_EMAIL = "firebase-adminsdk@your-project-id.iam.gserviceaccount.com"
  FIREBASE_PRIVATE_KEY = "-----BEGIN PRIVATE KEY-----\\nYOURKEY\\n-----END PRIVATE KEY-----\\n"

# ðŸœ‚ Stripe
  STRIPE_SECRET_KEY = "sk_live_..."
  PRICE_INITIATE_IDS = "price_xxx,price_yyy"
  PRICE_FULL_IDS = "price_zzz"
  PRICE_FULL_LIFETIME_IDS = "price_www"

# ðŸœ‚ TGK App
  APP_SECRET = "your_random_secure_string"
  SITE_URL = "https://thegnostickey.com"

# ===========================================================
# ðŸœ‚ Optional: Archived / Experimental Functions
# ===========================================================

[[functions]]
  name = "sync-custom-claims"
  included_files = ["netlify/_archive/sync-custom-claims.js"]
  included = false  # Disabled in production

# ===========================================================
# ðŸœ‚ Notes:
# - Builds Eleventy static site to `_site`
# - All Netlify Functions deployed from `/netlify/functions`
# - Uses Node 18+ runtime (for Stripe & Firebase Admin compatibility)
# ===========================================================

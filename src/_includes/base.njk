<!doctype html>
<html lang="en" data-theme="{{ theme_mode or 'dark' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or "The Gnostic Key" }}</title>
  {% set bust = collections.all | length %}

  <!-- Early theme init (prevents FOUC) -->
  <script>
  (function(){try{
    var KEY='tgk_theme';
    var t=localStorage.getItem(KEY)||'{{ theme_mode or "dark" }}';
    document.documentElement.setAttribute('data-theme',t);
  }catch(e){}})();
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="/css/tokens/light.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/tokens/dark.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/tokens/accents.css?v={{ bust }}">

  <link rel="stylesheet" href="/css/base/gnostic-core.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/base/typography-scale.css?v={{ bust }}">

  <link rel="stylesheet" href="/css/layout/layout-grid.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/layout/page-structure.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/layout/header-styles.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/layout/footer-styles.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/layout/dashboard-styles.css?v={{ bust }}">

  <link rel="stylesheet" href="/css/components/button-styles.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/components/card-styles.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/components/form-styles.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/components/glyph-styles.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/components/quiz.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/components/teachings-scroll.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/components/vault-styles.css?v={{ bust }}">

  <link rel="stylesheet" href="/css/navigation/nav-bar.css?v={{ bust }}">
  <link rel="stylesheet" href="/css/navigation/theme-toggle.css?v={{ bust }}">

  <link rel="stylesheet" href="/css/utilities/visibility-gates.css?v={{ bust }}">

  {% block head %}{% endblock %}
</head>

{# Accent class by URL if not set in front matter #}
{% set __ac = accent %}
{% if not __ac and page and page.url %}
  {% if page.url.indexOf('/pillars/the-gnostic-eye/') > -1 %}{% set __ac = 'eye' %}
  {% elif page.url.indexOf('/pillars/the-obsidian-key/') > -1 %}{% set __ac = 'obsidian' %}
  {% elif page.url.indexOf('/pillars/the-vault/') > -1 %}{% set __ac = 'vault' %}
  {% elif page.url.indexOf('/pillars/the-teachings/') > -1 %}{% set __ac = 'gold' %}
  {% elif page.url.indexOf('/pillars/the-resonant-key/') > -1 %}{% set __ac = 'resonant' %}
  {% endif %}
{% endif %}
{% set __ac = __ac or 'lightgold' %}

<body class="template-base {{ __ac | trim }}">
  <a class="skip-link" href="#content">Skip to content</a>

  {% include "partials/topbar.njk" %}

  <main id="content" class="site-main">
    {{ content | safe }}
  </main>

  {% include "partials/footer.njk" %}

  <!-- JS -->
  <script defer src="/js/nav.js?v={{ bust }}"></script>
  {% block scripts %}{% endblock %}

  <!-- Floating Controls (Bottom Right) -->
  <div class="floating-toggles">
    <button type="button" id="theme-toggle" class="theme-toggle-floating" aria-label="Toggle Theme">
      <span class="icon" aria-hidden="true">☀️</span>
    </button>
    <button type="button" id="scrollTopBtn" class="theme-toggle-floating" title="Return to Top">⬆️</button>
  </div>

  <script defer src="/js/toggles.js?v={{ bust }}"></script>
</body>
</html>

{# ============================================================
   TGK — Community Topic Template (v2.0 FINAL)
   Features:
     • Floating section tabs
     • Fully integrated discussion engine
     • Add Reply section
     • Thread list
     • Share block
     • Correct IDs for JS engine
============================================================ #}

{% extends "base.njk" %}

{% block content %}
<main class="main-content">

  {# Floating navigation (Discussion, Add Reply, Share) #}
  {% include "partials/page-tabs-community.njk" %}

  <section class="content-container">

    <!-- INTRODUCTION -->
    <section id="topic-intro" class="section-block">
      <h1 class="section-heading">
        {{ title or ("Topic: " + topicId | labelize) }}
      </h1>

      {% if description %}
        <p class="lead">{{ description }}</p>
      {% endif %}
    </section>


    <!-- PARTICIPATION RULES -->
    <section id="guidance" class="section-block">
      <h2 class="section-heading">How to Participate</h2>

      <ul class="rules-list">
        <li>Begin every reply with a Steel Man summary.</li>
        <li>Engage ideas, not individuals.</li>
        <li>Clarify before criticising.</li>
        <li>Protect clarity and intellectual honesty.</li>
      </ul>

      <p class="muted small">
        Full guidelines:
        <a href="/pillars/tgk-community/guide/charter/" class="link-accent">
          TGK Community Charter
        </a>.
      </p>
    </section>


    <!-- DISCUSSION ENGINE ROOT -->
    <section
      id="discussion-root"
      class="section-block"
      data-topic-id="{{ topicId }}"
      data-min-write-tier="{{ minWriteTier }}"
    >

      <!-- ADD YOUR CONTRIBUTION -->
      {% include "components/discussion/reply-prompt.njk" %}

      <!-- THREAD LIST -->
      {% include "components/discussion/thread-list.njk" %}
    </section>


    <!-- SHARE BLOCK -->
    <section id="share" class="section-block">
      <h2 class="section-heading">Share this Discussion</h2>

      <div class="share-buttons">
        <a class="btn outline"
           href="https://x.com/intent/tweet?text={{ title | urlencode }}&url={{ page.url | absoluteUrl | urlencode }}"
           target="_blank" rel="noopener">
          Share on X (Twitter)
        </a>

        <a class="btn outline"
           href="https://t.me/share/url?url={{ page.url | absoluteUrl | urlencode }}&text={{ title | urlencode }}"
           target="_blank" rel="noopener">
          Share on Telegram
        </a>
      </div>
    </section>

  </section>
</main>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script type="module" src="/js/discussion-topic.js"></script>
  <script type="module" src="/js/community-delete.js"></script>
  <script type="module" src="/js/community-edit.js"></script>
  <script type="module" src="/js/community-votes.js"></script>
  <script type="module" src="/js/community-pin.js"></script>
{% endblock %}

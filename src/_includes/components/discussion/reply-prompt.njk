<section id="add-reply" class="section-subblock anchor-target">

  <p id="discussion-status" class="discussion-status muted small"></p>
  <p id="discussion-auth-hint" class="muted small"></p>

  <form id="discussion-form" class="discussion-form">

    <div class="form-field">
      <label for="reply-intent" class="form-label">Post type</label>

      <select id="reply-intent" name="intent" class="form-input" aria-describedby="steelman-hint">
        <option value="comment" selected>Comment</option>
        <option value="reply">Reply</option>
        <option value="agree">Agree</option>
        <option value="insight">Insight</option>
        <option value="challenge">Challenge</option>
      </select>

      <p id="steelman-hint" class="muted small">
        Steel Man is required only for Challenge posts replying to a specific comment.
      </p>
    </div>

    <div class="form-field" id="steelman-field-wrap" hidden>
      <label for="steelman-summary" class="form-label">Steel Man Summary</label>
      <textarea id="steelman-summary"
                name="steelmanSummary"
                class="form-textarea"
                placeholder="Summarise the strongest version of the position you are replying to (10 to 40 words)."></textarea>
      <p class="muted small">Aim for 10 to 40 words, and keep it fair.</p>
    </div>

    <div class="form-field">
      <label for="reply-body" class="form-label">Your response</label>
      <textarea id="reply-body"
                name="body"
                class="form-textarea"
                placeholder="Offer your analysis, commentary, or reflection..."></textarea>
    </div>

    <div class="form-field">
      <label for="pseudonym" class="form-label">Pseudonym (optional)</label>
      <input id="pseudonym"
             name="pseudonym"
             type="text"
             class="form-input"
             placeholder="How you wish to appear in this thread...">
    </div>

    <!-- Reply context -->
    <div id="reply-context" class="reply-context" hidden>
      <p class="small muted">
        Replying to:
        <em id="reply-context-snippet"></em>
      </p>
      <button type="button" id="cancel-reply-context" class="btn-link">Cancel</button>
    </div>

    <!-- Hidden parent-reply field (CRITICAL for nesting) -->
    <input type="hidden" id="parent-reply-id" name="parentReplyId" value="">

    <div class="btn-row">
      <button type="submit" class="btn" form="discussion-form">POST</button>
    </div>

  </form>

</section>

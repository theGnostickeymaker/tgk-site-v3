{# =========================================================
   ğŸœ‚ TGK â€” Pillar / Series Grid Partial (v3.0)
   Purpose:
   Renders a responsive card grid for collections such as:
   â€¢ Pillar landing pages
   â€¢ Series selection pages
   â€¢ Episode or Vault collections

   âœ… Expects:
   - pillarGrid = [
       {
         href, title, glyph, desc/tagline,
         tier (free/initiate/adept),
         state (default, coming-soon, premium, locked, archived, draft),
         image (optional thumbnail),
         badge (optional override)
       }
     ]

   ğŸ§­ behavior:
   â€¢ Automatically applies classes and overlays per state
   â€¢ Shows a glyph and title prominently
   â€¢ Adds tier badge (â€œFreeâ€, â€œInitiateâ€, Adept Accessâ€)
   â€¢ Clean fallback handling for missing fields

   âœ¨ State Guide:
   default      â†’ normal card
   coming-soon  â†’ greyed banner
   premium      â†’ golden glow
   locked       â†’ semi-transparent lock overlay
   archived     â†’ faded aesthetic
   draft        â†’ soft gradient + â€œIn Developmentâ€ label

   âš™ï¸ Notes:
   â€¢ Fully responsive (uses .portal-grid layout container)
   â€¢ Accessible â€” non-decorative text always wrapped in <p>/<h3>
   â€¢ Safe for reuse on Vault, Teachings, Obsidian Key, etc.
   ========================================================= #}

{%- if pillarGrid and pillarGrid.length -%}
<section class="pillar-grid">
  <div class="portal-grid">
    {% for c in pillarGrid %}
      {# --- Derive state + CSS class --- #}
      {% set state = c.state or c.status or "default" %}
      {% set cls = "gnostic-card" %}
      {% if state == "premium" %}
        {% set cls = cls + " premium" %}
      {% elif state == "coming-soon" %}
        {% set cls = cls + " coming-soon" %}
      {% elif state == "locked" %}
        {% set cls = cls + " locked" %}
      {% elif state == "archived" %}
        {% set cls = cls + " archived" %}
      {% elif state == "draft" %}
        {% set cls = cls + " draft" %}
      {% endif %}

      <article class="{{ cls }}">
        <a class="card-link" href="{{ c.href or c.url or '#' }}">

          {# --- Optional thumbnail image --- #}
          {% if c.image %}
            <figure class="card-media">
              <img src="{{ c.image }}" alt="{{ c.title or 'Card Image' }}" loading="lazy">
            </figure>
          {% endif %}

          <div class="card-body">
            {% if c.glyph %}
              <div class="card-glyph" aria-hidden="true">{{ c.glyph }}</div>
            {% endif %}

            <h3 class="card-title">{{ c.title or "Untitled" }}</h3>

            {# --- Optional tagline / description --- #}
            {% if (c.desc and c.desc != state) or (c.tagline and c.tagline != state) %}
              <p class="card-desc">{{ c.desc or c.tagline }}</p>
            {% endif %}
          </div>

          {# --- Overlay banners for card state --- #}
          {% if state == "coming-soon" %}
            <div class="card-overlay"><span class="banner">Coming Soon</span></div>
          {% elif state == "premium" %}
            <div class="card-overlay"><span class="banner">Premium</span></div>
          {% elif state == "locked" %}
            <div class="card-overlay"><span class="banner">Locked</span></div>
          {% elif state == "archived" %}
            <div class="card-overlay"><span class="banner">Archived</span></div>
          {% elif state == "draft" %}
            <div class="card-overlay"><span class="banner">In Development</span></div>
          {% endif %}

          {# --- Tier badge logic (v4.0) --- #}
          {% set badgeTxt = c.badge %}

          {# Normalise tier strings (legacy support) #}
          {% set tRaw = (c.tier or "free") | lower | trim %}
          {% set t = tRaw %}

          {# Legacy aliases #}
          {% if t == "initiate-trial" %}
            {% set t = "free-intro" %}
          {% endif %}

          {% if not badgeTxt %}
            {% if t == "admin" %}
              {% set badgeTxt = "Admin" %}
            {% elif t == "adept" %}
              {% set badgeTxt = "Adept Access" %}
            {% elif t == "initiate" %}
              {% set badgeTxt = "Initiate" %}
            {% elif t == "verified" %}
              {% set badgeTxt = "sign-up" %}
            {% elif t == "free-intro" %}
              {% set badgeTxt = "Free Intro" %}
            {% elif t == "free" %}
              {% set badgeTxt = "Free" %}
            {% else %}
              {# Unknown tier, hide badge unless explicitly provided #}
              {% set badgeTxt = "" %}
            {% endif %}
          {% endif %}

          {% if badgeTxt %}
            <div class="card-badge tier-badge tier-{{ t }}">{{ badgeTxt }}</div>
          {% endif %}

        </a>
      </article>
    {% endfor %}
  </div>
</section>
{%- endif -%}

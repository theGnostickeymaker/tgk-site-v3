---
layout: layouts/base.njk
title: "Account"
description: "Manage subscription"
theme: null
---

<h1>Account</h1>
<p id="tier">Checking accessâ€¦</p>
<button id="refresh" style="display:none">Refresh Access</button>

<script>
const params = new URLSearchParams(location.search);
const sessionId = params.get("session_id");

async function setEntitlements(){
  if(!sessionId) return;
  await fetch("/.netlify/functions/set-entitlements", {
    method:"POST", headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ session_id: sessionId })
  });
  history.replaceState({}, "", location.pathname); // clean URL
}
function readTier(){
  const m = document.cookie.match(/(?:^|; )tgk_ent=([^;]+)/);
  if(!m) return "free";
  try{
    const [payload] = decodeURIComponent(m[1]).split(".");
    const json = JSON.parse(atob(payload.replace(/-/g,"+").replace(/_/g,"/")));
    return json.tier || "free";
  }catch(e){ return "free"; }
}
(async ()=>{
  if(sessionId) await setEntitlements();
  document.getElementById("tier").textContent = "Your access: " + readTier().toUpperCase();
})();
</script>

---
layout: base.njk
title: "Your TGK Dashboard"
description: "Your personal TGK space â€” access bookmarks, progress, membership, and billing."
glyph: "ðŸœ‚"
glyphRow: ["ðŸœ‚", "â˜¥", "ðŸœ‚"]
bodyClass: "lightgold requires-auth"
permalink: "/dashboard/index.html"

breadcrumbs:
  - { title: "The Gnostic Key", url: "/" }
  - { title: "Membership",  url: "/membership/"}
  - { title: "Dashboard" }
---
{% block head %}
  {% set socialImage = "/tgk-assets/images/share/system/dashboard.jpg" %}
  {% include "partials/head-meta.njk" %}
  {% set headline = "Dashboard â€” The Gnostic Key" %}
  {% set base = "/dashboard/" %}
  {% include "partials/jsonld-collection.njk" %}
{% endblock %}

<body>
<main class="main-content page-dashboard">
  <section class="content-container" id="page-dashboard">

    <!-- âœ¦ Welcome Header -->
    <div class="dashboard-welcome">
      <h2 class="section-heading">
        Welcome, <span id="user-name" class="highlight">Seeker</span>
      </h2>
      <p class="muted small">
        Your current tier: <span id="tier-badge" class="tier-badge tier-free">Free</span>
        <span class="member-since">Member since <span id="member-since">â€”</span></span>
      </p>
    </div>

    <!-- âœ¦ Membership Management -->
    <section class="section-block">
      <h3 class="section-heading">Membership & Billing</h3>
      <div class="btn-wrap">
        <a href="/membership/" class="btn outline">View / Manage Membership</a>
      </div>
      <p class="small">
        Upgrade, join, or manage your billing anytime in your membership centre.
      </p>
    </div>
  </section>

  <!-- âœ¦ Profile Information -->
  <section class="section-block auth-form">
    <h2 class="section-heading">Profile Information</h2>
    <p class="lead muted">Update your display name or review your account details below.</p>

    <form id="profile-form" class="tgk-form" autocomplete="off" novalidate>
      <div class="form-group">
        <label for="profile-name">Display Name</label>
        <input type="text" id="profile-name" placeholder="Your display name" required />
      </div>

      <div class="form-group">
        <label for="profile-email">Email Address</label>
        <input type="email" id="profile-email" placeholder="your@email.com" disabled />
      </div>

      <div class="btn-wrap center">
        <button type="submit" class="btn outline full-width">Save Changes</button>
        <span id="profile-status" class="small muted"></span>
      </div>
    </form>

    <p class="auth-note">
      Having trouble? <a href="/password-reset/">Reset your password</a> or <a href="/signin/">sign out</a> to switch accounts.
    </p>
  </section>

    <!-- âœ¦ Activity Widgets (optional hidden) -->
    <section hidden>
      <h3 class="section-heading">Your Activity</h3>
      <div class="dashboard-widgets">
        <div id="widget-quiz-progress" class="widget-slot"></div>
        <div id="widget-community-feed" class="widget-slot"></div>
        <div id="widget-key-balance" class="widget-slot"></div>
      </div>
    </section>

    <!-- âœ¦ Bookmarks -->
    <section class="section-block">
    <h3 class="section-heading">Your Bookmarks</h3>
    <div id="bookmark-dashboard">
      <p id="bookmark-loading" class="muted small">Loading bookmarksâ€¦</p>
      <div id="bookmark-grid-mount"></div>
      <p id="no-bookmarks" class="muted small" hidden>
        No bookmarks yet. Explore the <a href="/pillars/the-teachings/">Teachings</a> or
        the <a href="/pillars/the-vault/">Vault</a> to begin your journey.
      </p>
    </div>
  </section>

  <!-- âœ¦ Logout -->
  <section class="section-block">
    <h3 class="section-heading">Sign Out</h3>
    <p class="small">You can securely sign out of your TGK account below.</p>

    <div class="btn-wrap center">
      <button id="logout-btn" class="btn outline">Sign Out</button>
    </div>
  </section>

  <div class="gnostic-divider">
    <span class="divider-symbol pillar-glyph spin glow" aria-hidden="true">{{ glyph }}</span>
  </div>
</main>

<!-- ðŸœ‚ Dashboard Logic -->
<script type="module">
  import {
    loadDashboardHeader,
    refreshEntitlementsLive,
    pageSignout,
    saveProfile
  } from "/js/tgk-user.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

  const auth = getAuth();

  document.addEventListener("DOMContentLoaded", () => {
    const cachedTier = localStorage.getItem("tgk-tier");
    if (cachedTier) updateTierUI(cachedTier);
  });

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.__TGK_GATE__?.saveReturnUrl?.();
      return window.location.replace("/signin/");
    }

    // ðŸ”¹ Always refresh live entitlements
    await refreshEntitlementsLive(user);
    await loadDashboardHeader(user);

    // ðŸ”¹ Bind actions
    document.getElementById("profile-form").addEventListener("submit", saveProfile);
    document.getElementById("logout-btn").addEventListener("click", pageSignout);
    document.getElementById("upgrade-btn").addEventListener("click", async () => {
      const token = await user.getIdToken();
      const res = await fetch("/.netlify/functions/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, uid: user.uid, email: user.email })
      });
      const data = await res.json();
      if (data.url) window.location.href = data.url;
      else alert("Could not start checkout. Please try again.");
    });
    document.getElementById("billing-btn").addEventListener("click", async () => {
      const token = await user.getIdToken();
      const res = await fetch("/.netlify/functions/create-portal-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, email: user.email })
      });
      const data = await res.json();
      if (data.url) window.location.href = data.url;
      else alert("Could not open billing portal.");
    });
  });
</script>

<script type="module" src="/js/bookmarks.js?v={{ bust }}"></script>
</body>
